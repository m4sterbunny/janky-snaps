{"version":3,"sources":["../src/common/endowments/date.ts"],"names":[],"mappings":";;;;;AASA,SAAS,aAAa;AACpB,QAAM,OAAO,OAAO;AAAA,IAClB,gBAAgB;AAAA,EAClB;AAEA,MAAI,cAAc;AAClB,QAAM,MAAM,MAAM;AAChB,UAAM,SAAS,gBAAgB,KAAK,IAAI;AACxC,UAAM,UAAU,KAAK,MAAM,SAAS,KAAK,OAAO,CAAC;AACjD,QAAI,UAAU,aAAa;AACzB,oBAAc;AAAA,IAChB;AACA,WAAO;AAAA,EACT;AAEA,QAAM,UAAU,YAAa,MAAiB;AAC5C,WAAO,QAAQ;AAAA,MACb,gBAAgB;AAAA,MAChB,KAAK,WAAW,IAAI,CAAC,IAAI,CAAC,IAAI;AAAA,MAC9B;AAAA,IACF;AAAA,EACF;AAEA,OAAK,QAAQ,CAAC,QAAQ;AACpB,YAAQ,eAAe,SAAS,KAAK;AAAA,MACnC,cAAc;AAAA,MACd,UAAU;AAAA,MACV,OAAO,QAAQ,QAAQ,MAAM,gBAAgB,KAAK,GAAG;AAAA,IACvD,CAAC;AAAA,EACH,CAAC;AAED,SAAO,EAAE,MAAM,OAAO,OAAO,EAAE;AACjC;AAEA,IAAM,kBAAkB;AAAA,EACtB,OAAO,CAAC,MAAM;AAAA,EACd,SAAS;AACX;AAEA,IAAO,eAAQ","sourcesContent":["import { rootRealmGlobal } from '../globalObject';\n\n/**\n * Creates a {@link Date} constructor, with most of the same properties as the global object.\n * The Date.now() function has added noise as to limit its precision and prevent potential timing attacks.\n * The Date constructor uses this now() function to seed itself if no arguments are given to the constructor.\n *\n * @returns A modified {@link Date} constructor with limited precision.\n */\nfunction createDate() {\n  const keys = Object.getOwnPropertyNames(\n    rootRealmGlobal.Date,\n  ) as (keyof typeof Date)[];\n\n  let currentTime = 0;\n  const now = () => {\n    const actual = rootRealmGlobal.Date.now();\n    const newTime = Math.round(actual + Math.random());\n    if (newTime > currentTime) {\n      currentTime = newTime;\n    }\n    return currentTime;\n  };\n\n  const NewDate = function (...args: unknown[]) {\n    return Reflect.construct(\n      rootRealmGlobal.Date,\n      args.length === 0 ? [now()] : args,\n      new.target,\n    );\n  } as DateConstructor;\n\n  keys.forEach((key) => {\n    Reflect.defineProperty(NewDate, key, {\n      configurable: false,\n      writable: false,\n      value: key === 'now' ? now : rootRealmGlobal.Date[key],\n    });\n  });\n\n  return { Date: harden(NewDate) };\n}\n\nconst endowmentModule = {\n  names: ['Date'] as const,\n  factory: createDate,\n};\n\nexport default endowmentModule;\n"]}